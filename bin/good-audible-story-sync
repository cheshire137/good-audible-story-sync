#!/usr/bin/env ruby
# encoding: utf-8

require_relative "../lib/good_audible_story_sync"

options = GoodAudibleStorySync::Options.parse(script_name: __FILE__)

audible_auth = GoodAudibleStorySync::Audible::AuthFlow.run(output_file: options.credentials_file)
if audible_auth.nil?
  exit 1
end

audible_client = GoodAudibleStorySync::Audible::Client.new(auth: audible_auth, options: options)
puts "Getting Audible user profile..."
user_profile = audible_client.get_user_profile
puts user_profile.to_s(indent_level: 1)

puts "Getting first Audible library page..."
total_count, items = audible_client.get_library_page(per_page: 1)
puts "#{total_count} item(s) in Audible library"
item = items.first
asin = item&.asin
if asin
  puts "Loading ASIN #{asin} details..."
  pp audible_client.get_library_item(asin: asin)
end
